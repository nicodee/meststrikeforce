<!DOCTYPE html>
<html lang="en">
	<head>
        <title>MEST Strike Force - All</title>
		<meta name="viewport" content="initial-scale=1.0, width=device-width"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="../../../scripts/rateit/src/rateit.css" rel="stylesheet" type="text/css">
		<link href="../../../scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="../../../scripts/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
		<link href="../../../scripts/css/search/search.css" rel="stylesheet" media="screen">
		<link href="../../../scripts/css/search-result.css" rel="stylesheet" media="screen">
		<link href="../../../scripts/iCheck/skins/line/green.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../../scripts/css/mentorcaption.css">
		<link rel="stylesheet" type="text/css" href="../../../scripts/css/captionstyle.css">
		<link href="../../../scripts/iCheck/skins/flat/purple.css" rel="stylesheet">
		<link href="../../../scripts/iCheck/skins/flat/pink.css" rel="stylesheet">
		<link href="../../../scripts/iCheck/skins/flat/red.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../../../scripts/css/search/search-result-mentor.css">
		<link rel="stylesheet" type="text/css" href="../../../scripts/css/search/custom.css">
		<style>
			body{
				background: #f5f5f5;
			}
			#mentor-label {
				background: #ddd;
				border-radius: 0px;
			}
			#mentors2 {
				margin-top: -20px; 
			}
			.accordion-group {
				background: #fff;

			}
			#tech-list ul li {
				width: 23%;
			}
			.rateit button.rateit-reset {
				margin-top: 9px;
				margin-right: 6px;
			}
			#myModal {
				background-color: #D7D7D7;
				width: 90%;
				margin-left: -45%;
			}
			#position-description {
				margin-top: 3px;
				font-weight: normal;
				font-size: 60%;
			}
			#position-duration-description {
				margin-top: 0px;
			}
			.navbar-inverse .navbar-inner {
			  background-image: none;
			  background-color: #222;
			}
			.navbar .brand {
				display: block;
				float: left;
				padding: 15px 20px 10px;
				margin-left: -20px;
				font-size: 18px;
				font-weight: 200;
				color: #777;
			}
			#skills li {
				list-style: none;
				float: left;
				width: 33%;
				margin-top: 20px;			
			}
		</style>
	</head>

	
	<body>
		<div id="navigation-bar" class="row">
			<div class="navbar navbar-inverse navbar-fixed-top">
			    <div class="navbar-inner">
			        <div class="container">
			          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			            <span class="icon-bar"></span>
			            <span class="icon-bar"></span>
			            <span class="icon-bar"></span>
			          </button>
				      <a href="/" class="brand">MEST Strike Force</a>			          
			          <div class="nav-collapse collapse pull-right">
			            <ul class="nav">
		            	{% if user.user_profile == "Administrator" %}
			              <li>
			                <a href="/admin">Dashboard</a>
			              </li>
		            	{% endif %}
			              <li class="active">
			                <a href="/search">Search</a>
			              </li>
			              <li class="">
			                <a href="/messages">Messages</a>
			              </li>
						  <li class="dropdown">
						   	  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-user"></i> {{user.first_name}}<b class="caret"></b></a>
							  <ul class="dropdown-menu">
								  <li id="logout"><a href="/signout">Logout</a></li>
							  </ul>
						  </li>
			            </ul>
			          </div>
			        </div>
			    </div>
			</div>
		</div>
		<div id="row-fluid">
			<div class="container-fluid">
			  <div class="row-fluid">
			    <div class="span10 offset1 pull-left" id="search-main">
			    	

			    	
			    	<div id="search-results-all" class="row-fluid">

			    		<div class="row-fluid" id="mentors">
			    			<div class="navbar navbar-inner block-header" id="mentor-label"><label><h5>All Strike Force Members ({{mentors|length}})</h5></label></div>
				    		<div class="item" id="mentors2">
				    			<div class="row-fluid search-result-mentor">
				    				<ul class="grid cs-style-3">
				    					{% for mentor in mentors %}
				    					<li class="span3 found-result-mentor">
				    						<figure>
				    							<div>
													<img src="{{mentor.picture}}" alt="img04">
												</div>
												<figcaption data-user_id="{{mentor.key().id()}}">
													<div>
														<h3 class="name-mentor">{{mentor.first_name}} {{mentor.last_name}}</h3>
														<span>{{mentor.programs[0].mini_bio}}</span>
													</div>
													<a href="#myModal" class="user_id" data-user_id="{{mentor.key().id()}}" data-toggle="modal">Take a look</a>
												</figcaption>
											</figure>
										</li>
				    					{% endfor%}
								    </ul>
				    			</div>
				    		</div>
				    	</div>

			    		<div class="row-fluid" id="full-profile-mentor">
			    			<div class="row-fluid" id="full-profile-nav">					

								<!-- MODAL========== -->
								 
								<!-- Modal -->
								<div id="myModal" class="modal hide fade " tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
								  <div class="modal-header">
								    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
								    <h3 id="myModalLabel">Strike Force Member Profile</h3>
								  </div>
								  <div class="modal-body">
								    <div class="cover-banner" id="mentor-full-view"> <!-- mentor profile begins -->	
					    			<div class="row-fluid" id="full-profile-content">
					    				<div class="span7 item" id="full-profile-content-left">


					    					 <div class="" id="mentor-full-view"> <!-- mentor profile begins -->	
								    			<div class="row item" id="profile-head">
											    	
														<div class="span5" id="profile-brief-img">
															<ul class="grid">
														        <li class="">
														          <figure class="">
														            <div>
														            	<img  id="modal-pic" src="" alt="picture">
														            </div>
														          </figure>
														        </li>
														    </ul>
										            		<input type="hidden" id="backing6">
															<div class="rateit" id="rateit5" data-rateit-min="0"  data-rateit-ispreset="true">
															</div>
														</div>
														<div class="span7" id="profile-brief-text">
															<div class="row-fluid">
																<label id="profile-name">
																	<h3 id="mentor-profile-name">
																		<strong>
																		</strong>
																	</h3>
																</label>
																<span>
																	<label id="profile-company-position">
																		<p></p>
																	</label>
																</span>
															</div>
															<div class="row-fluid" id="profile-brief-location">
																<span></span>
															</div>
															<div class="row-fluid" id="profile-brief-schedule">
									    						<span></span>
															</div>
														</div>
													
								    			</div>
								    		</div>	

					    					<div class="row-fluid"  id="profile-summary">
					    						<div class="row-fluid" id="profile-summary-label"><label><h5>SUMMARY</h5></label></div>
					    						<div class="row-fluid"  id="profile-summary-content">
						    						<span>
							    						<p></p>
						    						</span>
						    					</div>
					    					</div>
					    					<div class="row-fluid" id="profile-resume">
					    						<div class="profile-resume-label"><label><h5>EXPERIENCE</h5></label></div>
					    						<div class="row-fluid" id="profile-resume-list">
					    						</div>
					    					</div>
					    					<div class="row-fluid" id="profile-education">
					    						<div class="profile-education-label"><label><h5>Education</h5></label></div>
					    						<div class="row-fluid" id="profile-education-list">
					    						</div>
					    					</div>
					    				</div>
					    				<div class="span4 pull-left" id="full-profile-content-right">
											
											<div class="row-fluid skills" id="profile-brief-skills-tags">
												<div class="row-fluid tags" id="">
					    							<label>ENDORSED ON LINKED IN FOR</label>
					    						</div>
												<span> </span>
											</div>

				    						<div class="row-fluid skills" id="industries">
				    							<div class="row-fluid tags" id="">
					    							<label>INDUSTRIES</label>
					    						</div>
				    							<span></span>
				    						</div>

				    						<div class="row-fluid skills" id="expertise">
				    							<div class="row-fluid tags" id="">
					    							<label>EXPERTISE</label>
					    						</div>
				    							<span></span>
				    						</div>

					    					<div class="row-fluid item" id="commments-and-ratings">
					    						<div class="row-fluid"><label><p>COMMENTS/RATINGS</p></div>
					    						<div class="row-fluid" id="comments-container">
					    						</div>
					    						<div class="row-fluid" id="new-comment-container">
					    							<div class="row-fluid" id="new-comment-textarea">
						    							<textarea id="comment-textarea"></textarea>
					    							</div>
					    							<div class="row-fluid" id="comment-submit-container">
						    							<button id="comment-submit-button" class="pull-right btn">Submit</button>
					    							</div>
					    						</div>
					    					</div>

					    				</div>
					    			</div>									
								</div> <!-- mentor profile ends -->

								  </div>
								  <div class="modal-footer">
								    <button class="btn pull-right" data-dismiss="modal" aria-hidden="true">Close</button>
								    	<a id="compose-message" class="btn btn-primary send-message" target="_blank">SEND MESSAGE</a>
								  </div>
								</div>
								 <!-- MODAL =============== -->
			    			</div>
							
			    			
			    		</div>	
			    	</div>	

			    </div>
			  </div>
			</div>
		</div> <!-- results container ends -->


		<script src="../../../scripts/js/modernizr.custom.js"></script>
    	<script src="../../../scripts/assets/js/jquery-2.0.3.min.js"></script>
    	<script src="../../../scripts/bootstrap/js/bootstrap.min.js"></script>
	    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script src="../../../scripts/rateit/src/jquery.rateit.js" type="text/javascript"></script>
		<script type="text/javascript">
		$(document).ready(function(){	
			$(".user_id").click(
				function(){
					var user_id = $(this).attr("data-user_id");
					fetchFullProfile(user_id);
				}
			);
		});


		function fetchFullProfile(user_id){
			var user_id = user_id.trim();
			action      = "getFullProfile";
			$.ajax('/search', {
				type: "POST",
				data:{user_id: user_id, action: action},
				success: handleFullProfileResponse
				}
			);
		}
		var count = 0;
		var new_comment  = 0;
		var edit_comment = false 
		var rated = false;

		function handleFullProfileResponse(data) {
			$("#myModalLabel").html(data);
			$('.des').popover();
			drawChart();
			$('#rateit5').rateit({ max: 5, step: 0.5, backingfld: '#backing6' });
			$("#rateit5").rateit("value", Number($("#modal-pic").attr("rating")));

			$(".rateit").click(
				function(e){ 
					if (rated == false){
						var rating = $("#rateit-range-2").attr("aria-valuenow");
						rated = true;
						rate(rating,rated);
					}
				}
			);

			$("#comment-submit-button").bind('click', function () {
					submitComment($(this));
				}
			);	
			bindObjects();
		}


		function drawChart() {
		  setTimeout(function(){google.load('visualization', '1', {'callback': drawChart, 'packages':['corechart']})}, 2000);
		  function drawChart() {
		    var data = google.visualization.arrayToDataTable([
		      ['Task', 'Hours Contributed'],
				['Hours Completed',     Number($("#piechart").attr("data-committed"))],
				['Hours Committed',    Number($("#piechart").attr("data-left"))]
		    ]);

		    var options = {
		      title: '',
		      colors:['#4d90fe','grey']
		    };

		    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
		    chart.draw(data, options);
		  }
		}	


		//called when a comment is being submitted
		function submitComment(comment_item){
			var action     = "new";
			var type       = "user";
			var content    = $("#comment-textarea").val();
			var entity_id  = $("#modal-pic").attr("data-user-id");
			comment(action, type, content , entity_id, "");	
		}

		//event listener for editing and deleting comment items
		function bindObjects(){
			$('.edit').bind("click", function(){ editComment( $(this) )} );
			$('.delete').bind("click", function(){ confirmDelete( $(this) )} );	
		}

		// dialogue box that pops up to confirm deletion of a comment
		function confirmDelete(comment_object){
			if( confirm("This comment will be permanently deleted. Do you want to proceed?") ){
				deleteComment(comment_object);
				$("#new-comment-container").show();
			}	
		}

		function deleteComment(comment_object){
			var commentor_id = comment_object.attr("data-commentor-id").trim();	
			var comment_item = $("."+commentor_id);
			var comment_id   = comment_item.attr("data-comment-id");
			comment_item.remove();
			var action    = "delete";
			var type      = "user";
			var entity_id = $("#modal-pic").attr("data-user-id");
			comment(action, type, "", entity_id, comment_id);
		};


		function editComment(comment_object){
			$("#new-comment-container").show();
			var commentor_id = comment_object.attr("data-commentor-id").trim();
			var comment_item = $("."+commentor_id);
			var comment_id   = comment_item.attr("data-comment-id");
			var content      = comment_item.find(".comment-content").text().trim();
		    $("#comment-textarea").val(content);
		    $("#comment-submit-button").attr("id", "comment-edit-button");
			$("#comment-edit-button").click(
				function(){
					var action         = "edit";
					var type           = "user";
					var new_content    = $("#comment-textarea").val();
					var entity_id      = $("#modal-pic").attr("data-user-id");
					comment(action, type, new_content , entity_id, comment_id);	
					$("#new-comment-container").hide();
					$("#comment-edit-button").attr("id", "comment-submit-button");
				}
			);	
		}


		//making ajax call to server for new comment
		function comment(comment_action, type, content, entity_id, comment_id){
			var action  = "comment"
			var comment = JSON.stringify({ 
										"content":content,
										"entity_id":entity_id, 
										"type":type, 
										"comment_action":comment_action,
										"comment_id": comment_id
									});
			console.log(new_comment);
			$.ajax("/search",{
				type: "POST",
				data: { action: action, comment: comment},
				success: handleCommentResponse
			});
		}


		function handleCommentResponse (data) {
			console.log(data);
			fetchFullProfile($("#modal-pic").attr("data-user-id"));
		}


		//making ajax call to confirm rating 
		function rate(rating,rated){
			var rating_id     = $("#modal-pic").attr("data-user-id").trim();
			var rating_type   = $("#modal-pic").attr("data-favorite-type").trim(); 
			var rating_value  = rating; 
			var action = "rate";
			$.ajax("/search",{
				type: "POST",
				data: {action:action, rating_id: rating_id, rating_type: rating_type, rating_value: rating_value},
				success: handleRateResponse
			})
		}

		//handling rating response from server
		function handleRateResponse(data){
			rated = false;
		}

		</script> 
	</body>
</html>
